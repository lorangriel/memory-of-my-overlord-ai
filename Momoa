#!/usr/bin/env python3
"""Interactive chat starter for a local gpt-oss-20b model.

This script connects to a server implementing the OpenAI API
specification at ``http://127.0.0.1:1234`` and uses the
``gpt-oss-20b`` model. No manual configuration or API keys are
required.
"""

from __future__ import annotations

from memory import ConversationMemory
from openai import OpenAI


def main() -> None:
    """Run an interactive chat with memory."""

    client = OpenAI(base_url="http://127.0.0.1:1234/v1", api_key="not-needed")
    memory = ConversationMemory()
    system_prompt = "Du är en hjälpsam assistent."

    print("Skriv ett meddelande (tom rad för att avsluta).")
    while True:
        user_input = input("you: ")
        if not user_input:
            break
        memory.add_message("user", user_input)

        messages = [{"role": "system", "content": system_prompt}]
        for msg in memory.get_recent(limit=10):
            messages.append({"role": msg.role, "content": msg.content})

        response = client.chat.completions.create(
            model="gpt-oss-20b", messages=messages, max_tokens=200
        )
        assistant_reply = response.choices[0].message["content"].strip()
        print(f"assistant: {assistant_reply}")
        memory.add_message("assistant", assistant_reply)


if __name__ == "__main__":
    main()
